# Plum Controller 配置文件示例
# 复制此文件为 .env 并修改配置
# 包含性能优化配置，实现快速故障恢复（<2秒）

# ========== 服务配置 ==========

# Controller监听地址
CONTROLLER_ADDR=:8080

# 数据库路径
CONTROLLER_DB=file:controller.db?_pragma=busy_timeout(5000)

# 数据目录（存放上传的artifacts）
CONTROLLER_DATA_DIR=.

# ========== 调度配置 ==========

# 任务调度器间隔（秒）
TASK_SCHED_INTERVAL_SEC=1

# 嵌入式任务默认超时（毫秒）
TASK_EMBEDDED_TIMEOUT_MS=30000

# 外部阶段控制系统基础URL（可选）
# 用于与外部控制系统（如FSL_MainControl）集成，实现阶段级别的任务管理
# 如果未设置，工作流将使用节点自身的payload，不会尝试访问外部系统
# 可以通过环境变量或工作流payload中的stageControlBase字段设置
# STAGE_CONTROL_BASE=http://127.0.0.1:4000

# ========== 故障转移配置 - 性能优化 ==========

# 节点心跳超时时间（秒）
# 优化：从30秒降低到3秒，实现快速故障检测
HEARTBEAT_TTL_SEC=3

# 故障转移检查间隔（秒）
# 优化：从10秒降低到1秒，实现快速迁移
FAILOVER_INTERVAL_SEC=1

# 是否启用自动迁移（节点故障时迁移应用），默认为 false
AUTO_MIGRATION_ENABLED=false

# ========== 服务发现配置 ==========
# 服务健康TTL（秒），超过该时间未收到心跳的端点将被判定为不健康
SERVICE_HEALTH_TTL_SEC=15

# ========== Agent性能优化配置 ==========

# Agent心跳间隔（秒）
# 优化：从5秒降低到1秒，提高故障检测速度
AGENT_HEARTBEAT_INTERVAL_SEC=1

# 进程监控间隔（秒）
# 优化：从5秒降低到1秒，实现快速重启
AGENT_PROCESS_CHECK_INTERVAL_SEC=1

# ========== 性能监控配置 ==========

# 是否启用性能监控
PERFORMANCE_MONITORING_ENABLED=true

# 性能阈值配置（毫秒）
RESTART_TIME_THRESHOLD_MS=2000
MIGRATION_TIME_THRESHOLD_MS=2000
DETECTION_TIME_THRESHOLD_MS=1000

# 性能统计清理间隔（小时）
PERFORMANCE_STATS_CLEANUP_HOURS=24

# ========== 弱网环境支持配置 ==========

# 弱网支持启用配置
WEAK_NETWORK_ENABLED=true
ADAPTIVE_ENABLED=true

# 请求超时配置
REQUEST_TIMEOUT=30s
READ_TIMEOUT=10s
WRITE_TIMEOUT=10s
IDLE_TIMEOUT=120s

# 连接池配置
MAX_IDLE_CONNS=100
MAX_IDLE_CONNS_PER_HOST=10
MAX_CONNS_PER_HOST=50
DISABLE_KEEP_ALIVES=false

# 限流配置
RATE_LIMIT_ENABLED=true
RATE_LIMIT_RPS=1000
RATE_LIMIT_BURST=2000

# 熔断器配置
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_TIMEOUT=60s
CIRCUIT_BREAKER_MAX_REQUESTS=5
CIRCUIT_BREAKER_INTERVAL=10s

# 重试配置
RETRY_ENABLED=true
RETRY_MAX_ATTEMPTS=3
RETRY_BASE_DELAY=100ms
RETRY_MAX_DELAY=5s

# 健康检查配置
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=5s

# 缓存配置
CACHE_ENABLED=true
CACHE_TTL=30s
CACHE_MAX_SIZE=1000

# 监控配置
METRICS_ENABLED=true
METRICS_INTERVAL=10s

