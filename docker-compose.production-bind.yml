# Plum 生产环境配置 - 使用绑定挂载
# 数据将存储在宿主机的 ./data 目录中

name: plum-production

services:
  # Plum Agent 服务 - 生产环境
  plum-agent:
    build:
      context: .
      dockerfile: docker/agent/Dockerfile
    container_name: plum-agent
    volumes:
      # 使用绑定挂载，数据存储在 ./data 目录
      - ./data:/app/data
      - ./agent-go/.env:/app/.env:ro
    environment:
      # 节点ID从环境变量获取，或使用默认值
      - AGENT_NODE_ID=${AGENT_NODE_ID:-node-${HOSTNAME:-default}}
      - CONTROLLER_BASE=${CONTROLLER_BASE:-http://plum-controller:8080}
      - AGENT_DATA_DIR=/app/data
    networks:
      - plum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "pgrep", "plum-agent"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# 网络配置
networks:
  plum-network:
    driver: bridge

# 注意：使用绑定挂载时不需要定义volumes
