# Agent-Go Changelog

## v1.1 (2025-10-09) - è¿›ç¨‹ç›‘æ§ä¿®å¤

### ğŸ› é‡å¤§Bugä¿®å¤
ä¿®å¤äº†Agentæ— æ³•æ£€æµ‹åˆ°è¿›ç¨‹æ­»äº¡çš„ä¸¥é‡é—®é¢˜ã€‚

**é—®é¢˜**ï¼š
- è¿›ç¨‹è¢«killåï¼ŒAgentä¸çŸ¥é“è¿›ç¨‹å·²æ­»
- Web UIçŠ¶æ€ä¸€ç›´æ˜¾ç¤º"Running"
- è¿›ç¨‹ä¸ä¼šè‡ªåŠ¨é‡å¯
- åœæ­¢/å¯åŠ¨åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ

**æ ¹æœ¬åŸå› **ï¼š
1. æ—§ä»£ç ä¾èµ–`ProcessState`å­—æ®µåˆ¤æ–­è¿›ç¨‹é€€å‡ºï¼Œä½†è¯¥å­—æ®µåªæœ‰è°ƒç”¨`Wait()`åæ‰æ›´æ–°
2. å°è¯•ä½¿ç”¨`Signal(0)`æ£€æµ‹ï¼Œä½†é‡åˆ°åƒµå°¸è¿›ç¨‹é—®é¢˜
3. Agentå¯åŠ¨è¿›ç¨‹é€šè¿‡`sh -c`ï¼Œå½“åº”ç”¨è¿›ç¨‹æ­»äº¡æ—¶ï¼Œshè¿›ç¨‹å˜æˆåƒµå°¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥`/proc/<pid>/stat`æ–‡ä»¶è·å–è¿›ç¨‹çœŸå®çŠ¶æ€
- è¯†åˆ«åƒµå°¸è¿›ç¨‹ï¼ˆçŠ¶æ€'Z'ï¼‰å¹¶åˆ¤å®šä¸ºå·²æ­»
- æ­£ç¡®è°ƒç”¨`Wait()`å›æ”¶åƒµå°¸è¿›ç¨‹
- ä¸ŠæŠ¥çŠ¶æ€ç»™Controller
- è‡ªåŠ¨é‡å¯æ­»äº¡çš„è¿›ç¨‹

### ğŸ“ æ—¥å¿—ä¼˜åŒ–

**åˆ é™¤çš„è°ƒè¯•æ—¥å¿—**ï¼š
- âŒ "=== Main loop iteration ===" (å¤ªé¢‘ç¹)
- âŒ "Heartbeat sent" (æ­£å¸¸æƒ…å†µæ— éœ€è®°å½•)
- âŒ "Got X assignments" (å¤ªè¯¦ç»†)
- âŒ "Sync: tracking X instances" (å¤ªé¢‘ç¹)
- âŒ "Instance X PID=Y state=Z alive=true" (æ­£å¸¸æƒ…å†µå¤ªåµ)

**ä¿ç•™çš„é‡è¦æ—¥å¿—**ï¼š
- âœ… "Detected instance X process died (PID Y)" (è¿›ç¨‹æ­»äº¡)
- âœ… "Reaped instance X (died), exit=N, phase=Failed" (æ¸…ç†æ­»è¿›ç¨‹)
- âœ… "Instance X process died, will restart" (å‡†å¤‡é‡å¯)
- âœ… "Started instance X, PID=Y" (å¯åŠ¨æ–°è¿›ç¨‹)
- âœ… "Heartbeat failed: ..." (åªåœ¨å¤±è´¥æ—¶è®°å½•)
- âœ… "Failed to get assignments: ..." (åªåœ¨å¤±è´¥æ—¶è®°å½•)
- âœ… "Failed to parse assignments: ..." (é”™è¯¯æƒ…å†µ)
- âœ… "Sent SIGTERM to instance X" (åœæ­¢è¿›ç¨‹)
- âœ… "Killed instance X" (å¼ºåˆ¶kill)

### ğŸ’¡ è®¾è®¡è¦ç‚¹

**è¿›ç¨‹å­˜æ´»æ£€æµ‹**ï¼š
```go
// è¯»å–/proc/<pid>/statè·å–è¿›ç¨‹çŠ¶æ€
statData := os.ReadFile("/proc/<pid>/stat")
// è§£æçŠ¶æ€å­—ç¬¦ï¼ˆR/S/D/T/Zç­‰ï¼‰
// Z = åƒµå°¸è¿›ç¨‹ = å·²æ­»
processAlive = (state != 'Z')
```

**ä¸ºä»€ä¹ˆä¸ç”¨Signal(0)**ï¼š
- Signal(0)æ— æ³•åŒºåˆ†åƒµå°¸è¿›ç¨‹
- åƒµå°¸è¿›ç¨‹è™½ç„¶å·²æ­»ï¼Œä½†ä»ç„¶å­˜åœ¨äºè¿›ç¨‹è¡¨
- éœ€è¦åˆ¤æ–­è¿›ç¨‹çš„å®é™…çŠ¶æ€

**ä¸ºä»€ä¹ˆä¼šæœ‰åƒµå°¸è¿›ç¨‹**ï¼š
- Agentç”¨`sh -c`å¯åŠ¨åº”ç”¨
- åº”ç”¨æ˜¯shçš„å­è¿›ç¨‹
- åº”ç”¨æ­»äº¡æ—¶ï¼Œshå˜æˆåƒµå°¸ï¼ˆç­‰å¾…è¢«Waitï¼‰
- å¿…é¡»Wait shè¿›ç¨‹æ‰èƒ½å®Œå…¨å›æ”¶

### ğŸ§ª æµ‹è¯•éªŒè¯

**æµ‹è¯•åœºæ™¯1**ï¼šKillè¿›ç¨‹
```bash
# æ€æ‰åº”ç”¨è¿›ç¨‹
kill -9 <PID>

# é¢„æœŸè¡Œä¸ºï¼ˆ5ç§’å†…ï¼‰ï¼š
# 1. Agentæ£€æµ‹åˆ°è¿›ç¨‹æ­»äº¡
# 2. ä¸ŠæŠ¥"Failed"çŠ¶æ€ç»™Controller
# 3. è‡ªåŠ¨é‡å¯è¿›ç¨‹
# 4. UIæ˜¾ç¤ºï¼šRunning â†’ Failed â†’ Running
```

**æµ‹è¯•åœºæ™¯2**ï¼šUIåœæ­¢/å¯åŠ¨
```bash
# UIç‚¹å‡»åœæ­¢
# é¢„æœŸï¼šAgentå‘é€SIGTERMï¼Œè¿›ç¨‹åœæ­¢ï¼ŒçŠ¶æ€Stopped

# UIç‚¹å‡»å¯åŠ¨
# é¢„æœŸï¼šAgenté‡æ–°å¯åŠ¨è¿›ç¨‹ï¼ŒçŠ¶æ€Running
```

### ğŸ“Š æ€§èƒ½å½±å“
- æ¯æ¬¡Syncæ£€æŸ¥è¿›ç¨‹çŠ¶æ€ï¼ˆè¯»å–/procæ–‡ä»¶ï¼‰
- å¼€é”€ï¼š~0.1ms per instance
- å¯¹äºæ­£å¸¸åœºæ™¯ï¼ˆ<100å®ä¾‹/èŠ‚ç‚¹ï¼‰å½±å“å¯å¿½ç•¥

### ğŸš€ å‡çº§æŒ‡å—

```bash
# 1. åœæ­¢æ—§Agent
pkill -f plum-agent

# 2. é‡æ–°ç¼–è¯‘
cd /home/stone/code/Plum/agent-go
go build -o plum-agent

# 3. å¯åŠ¨æ–°Agent
AGENT_NODE_ID=nodeA \
CONTROLLER_BASE=http://127.0.0.1:8080 \
./plum-agent
```

### âš ï¸ å·²çŸ¥é™åˆ¶
- ä»…æ”¯æŒLinuxï¼ˆä¾èµ–/procæ–‡ä»¶ç³»ç»Ÿï¼‰
- ä¸æ”¯æŒWindowså’ŒmacOS
- å¦‚éœ€è·¨å¹³å°ï¼Œéœ€è¦å¹³å°ç‰¹å®šçš„è¿›ç¨‹æ£€æµ‹å®ç°

---

## v1.0 (2025-10-09) - åˆå§‹ç‰ˆæœ¬

- Goè¯­è¨€é‡å†™Agent
- å®Œå…¨æ›¿ä»£C++ Agent
- åŠŸèƒ½100%å…¼å®¹
- ä»£ç ç®€åŒ–55%

