# Plum Agent 配置文件示例
# 复制此文件为 .env 并修改配置

# ========== 节点配置 ==========

# 节点ID（唯一标识）
AGENT_NODE_ID=nodeA

# Controller地址（默认使用主机名 plum-controller，可在 /etc/hosts 或 DNS 中配置）
CONTROLLER_BASE=http://plum-controller:8080

# Agent对外通告的IP（请填写该节点的内网/业务IP）
AGENT_IP=192.168.1.10

# Agent数据目录
AGENT_DATA_DIR=/tmp/plum-agent

# ========== 应用运行模式 ==========

# 应用运行模式：process（进程模式，默认）或 docker（容器模式）
# process: ZIP 应用以进程方式运行（传统模式）
# docker: ZIP 应用以Docker容器方式运行（需要挂载Docker socket）
# 注意：此环境变量仅对 ZIP 类型的应用生效
# 镜像类型的应用总是使用 Docker 模式，不受此环境变量影响
AGENT_RUN_MODE=process

# ========== 容器模式配置（仅当 AGENT_RUN_MODE=docker 时生效，镜像应用总是使用 Docker）==========

# 容器基础镜像（默认：alpine:latest）
# 所有应用容器将基于此镜像运行
PLUM_BASE_IMAGE=alpine:latest

# 容器内存限制（可选）
# 支持格式：512m, 1g, 2048 (字节)
# 不设置表示无限制
# PLUM_CONTAINER_MEMORY=512m

# 容器CPU限制（可选）
# 支持格式：1.0, 2, 0.5 (CPU核数)
# 不设置表示无限制
# PLUM_CONTAINER_CPUS=1.0

# 容器自定义环境变量（可选）
# 格式：KEY1=value1,KEY2=value2
# 例如：DISPLAY=:99,QT_QPA_PLATFORM=xcb
# PLUM_CONTAINER_ENV=DISPLAY=:99

# 容器网络模式（可选，默认：bridge）
# 可选值：host, bridge, none
#   - host: 容器使用宿主机网络，与宿主机共享网络栈（性能最好，但隔离性差）
#   - bridge: 容器使用 Docker 桥接网络（默认，推荐，隔离性好）
#   - none: 容器无网络（极少使用）
# 注意：网络模式影响容器内访问 Controller 的方式
# PLUM_CONTAINER_NETWORK_MODE=bridge

# Controller 主机地址（用于容器内访问 Controller，仅 Bridge 网络模式有效）
# 当应用运行在容器中时，如果 CONTROLLER_BASE 使用 localhost/127.0.0.1 或主机名（如 plum-controller），
# Agent 会自动添加主机映射，将 Controller 主机名映射到此 IP
#
# 网络模式说明：
#   - Host 模式：通常不需要设置此变量
#     * 容器和宿主机共享网络，可以直接使用 CONTROLLER_BASE 中的地址
#     * 如果 CONTROLLER_BASE=http://plum-controller:8080，容器内可以直接解析 plum-controller
#     * 如果 CONTROLLER_BASE=http://127.0.0.1:8080，容器内直接使用 127.0.0.1
#
#   - Bridge 模式：需要根据情况设置
#     * 如果 CONTROLLER_BASE 是 localhost/127.0.0.1：默认使用 172.17.0.1（Docker 默认网关 IP）
#     * 如果 CONTROLLER_BASE 是主机名（如 plum-controller）：
#       - Agent 会尝试从 /etc/hosts 解析该主机名
#       - 如果无法解析，使用 172.17.0.1
#     * 如果 Controller 在其他机器上，请设置为 Controller 的实际 IP
#
# 默认值（Bridge 模式）：
#   - localhost/127.0.0.1 → 172.17.0.1
#   - 主机名无法解析 → 172.17.0.1
# PLUM_CONTROLLER_HOST=172.17.0.1

# ========== Agent 自动注入到容器的环境变量 ==========
# 注意：以下环境变量是 Agent 自动注入到应用容器的，Agent 本身不需要配置
# Agent 会根据 CONTROLLER_BASE 自动计算并注入以下变量到容器中：
#
# CONTROLLER_BASE: Agent 会根据网络模式自动调整并注入到容器
#   - Host 模式：直接使用 CONTROLLER_BASE 的值
#   - Bridge 模式：如果是 localhost/127.0.0.1，会自动调整为 172.17.0.1 或 PLUM_CONTROLLER_HOST
#
# CONTROLLER_GRPC_ADDR: Agent 会根据 CONTROLLER_BASE 自动推导 gRPC 地址并注入到容器
#   - 从 CONTROLLER_BASE 提取主机名，端口固定为 9090
#   - 例如：CONTROLLER_BASE=http://plum-controller:8080 → CONTROLLER_GRPC_ADDR=plum-controller:9090
#   - 例如：CONTROLLER_BASE=http://127.0.0.1:8080 → CONTROLLER_GRPC_ADDR=127.0.0.1:9090 (host模式) 或 172.17.0.1:9090 (bridge模式)
#
# 应用容器中可以直接使用这些环境变量，无需在应用的 .env 文件中配置

# 宿主机库路径映射（可选，用于共享系统库）
# 格式：/path1,/path2,/path3
# 例如：/usr/lib,/usr/local/lib,/opt/qt/lib
# 这些路径会被只读挂载到容器的相同路径
# 适用于：多个应用需要共享相同的系统库（如Qt）
# 注意：需要确保宿主机和容器架构兼容（都是x86_64或都是ARM64）
# PLUM_HOST_LIB_PATHS=/usr/lib,/usr/local/lib

# Agent同步间隔（单位：秒），默认5
SYNC_INTERVAL_SEC=5

# ========== 镜像应用数据清理配置 ==========

# 是否在容器停止时自动清理镜像应用的数据目录（默认：false，保留数据）
# true/1: 容器停止时自动删除数据目录，防止数据目录越积越多
# false/0 或未设置: 保留数据目录，即使容器停止也不会删除（推荐，便于数据恢复）
# 注意：此选项仅对镜像类型的应用生效，ZIP 应用不受影响
# PLUM_AUTO_CLEAN_DATA=false

